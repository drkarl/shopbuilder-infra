# ShopBuilder Docker Compose Environment Configuration
# Copy this file to .env and fill in the values

# =============================================================================
# Spring Application Settings
# =============================================================================
SPRING_PROFILES_ACTIVE=production

# =============================================================================
# Container Images
# =============================================================================
SPRING_API_IMAGE=shopbuilder/spring-api:latest
SPRING_WORKERS_IMAGE=shopbuilder/spring-workers:latest

# =============================================================================
# Database Configuration (external PostgreSQL - not managed by this compose file)
# =============================================================================
SPRING_DATASOURCE_URL=jdbc:postgresql://db-host:5432/shopbuilder
SPRING_DATASOURCE_USERNAME=shopbuilder
# REQUIRED: Set a strong password for database access
SPRING_DATASOURCE_PASSWORD=

# =============================================================================
# RabbitMQ Configuration
# =============================================================================
RABBITMQ_USERNAME=shopbuilder
# REQUIRED: Set a strong password for RabbitMQ
RABBITMQ_PASSWORD=
RABBITMQ_VHOST=shopbuilder
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672

# =============================================================================
# AWS Configuration
# =============================================================================
# REQUIRED: AWS credentials for S3 access
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=eu-central-1
# REQUIRED: S3 bucket name for asset storage
S3_BUCKET_NAME=

# =============================================================================
# Security
# =============================================================================
# REQUIRED: Generate a strong random string for JWT secret, e.g.:
#   openssl rand -base64 64
JWT_SECRET=

# =============================================================================
# Port Configuration
# =============================================================================
SPRING_API_PORT=8080

# =============================================================================
# Worker Configuration
# =============================================================================
WORKER_CONCURRENCY=4

# =============================================================================
# JVM Configuration - Spring API
# Uses ZGC (low-latency garbage collector) optimized for virtual threads
# =============================================================================
# Override to customize JVM settings (default: ZGC with 1.5GB heap)
# IMPORTANT: JVM heap (-Xmx) should be ~75% of container memory limit to leave
# room for non-heap memory (metaspace, thread stacks, direct buffers, etc.)
# For SPRING_API_MEMORY_LIMIT=2G, use -Xmx1536m (1.5GB)
# JAVA_TOOL_OPTIONS=-XX:+UseZGC -XX:+ZGenerational -Xmx1536m -Xms512m -XX:+ExitOnOutOfMemoryError -Djava.security.egd=file:/dev/./urandom

# =============================================================================
# Resource Limits - Spring API
# =============================================================================
SPRING_API_CPU_LIMIT=2.0
SPRING_API_MEMORY_LIMIT=2G
SPRING_API_CPU_RESERVATION=0.5
SPRING_API_MEMORY_RESERVATION=512M

# =============================================================================
# JVM Configuration - Spring Workers
# =============================================================================
# Override to customize JVM settings for workers (default: same as API)
# IMPORTANT: JVM heap (-Xmx) should be ~75% of container memory limit
# For SPRING_WORKERS_MEMORY_LIMIT=2G, use -Xmx1536m (1.5GB)
# JAVA_TOOL_OPTIONS_WORKERS=-XX:+UseZGC -XX:+ZGenerational -Xmx1536m -Xms512m -XX:+ExitOnOutOfMemoryError -Djava.security.egd=file:/dev/./urandom

# =============================================================================
# Resource Limits - Spring Workers
# =============================================================================
SPRING_WORKERS_CPU_LIMIT=2.0
SPRING_WORKERS_MEMORY_LIMIT=2G
SPRING_WORKERS_CPU_RESERVATION=0.5
SPRING_WORKERS_MEMORY_RESERVATION=512M

# =============================================================================
# Resource Limits - RabbitMQ
# =============================================================================
RABBITMQ_CPU_LIMIT=1.0
RABBITMQ_MEMORY_LIMIT=512M
RABBITMQ_CPU_RESERVATION=0.25
RABBITMQ_MEMORY_RESERVATION=256M
