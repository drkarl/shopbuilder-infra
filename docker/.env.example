# ShopBuilder Docker Compose Environment Configuration
# Copy this file to .env and fill in the values

# =============================================================================
# Spring Application Settings
# =============================================================================
SPRING_PROFILES_ACTIVE=production

# =============================================================================
# Container Images
# =============================================================================
FRONTEND_IMAGE=shopbuilder/frontend:latest
SPRING_API_IMAGE=shopbuilder/spring-api:latest
SPRING_WORKERS_IMAGE=shopbuilder/spring-workers:latest

# =============================================================================
# Database Configuration (external PostgreSQL - not managed by this compose file)
# =============================================================================
SPRING_DATASOURCE_URL=jdbc:postgresql://db-host:5432/shopbuilder
SPRING_DATASOURCE_USERNAME=shopbuilder
# REQUIRED: Set a strong password for database access
SPRING_DATASOURCE_PASSWORD=

# =============================================================================
# RabbitMQ Configuration
# =============================================================================
RABBITMQ_USERNAME=shopbuilder
# REQUIRED: Set a strong password for RabbitMQ
RABBITMQ_PASSWORD=
RABBITMQ_VHOST=shopbuilder
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672

# =============================================================================
# AWS Configuration
# =============================================================================
# REQUIRED: AWS credentials for S3 access
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=eu-central-1
# REQUIRED: S3 bucket name for asset storage
S3_BUCKET_NAME=

# =============================================================================
# Security
# =============================================================================
# REQUIRED: Generate a strong random string for JWT secret, e.g.:
#   openssl rand -base64 64
JWT_SECRET=

# =============================================================================
# Stripe Payment Gateway
# =============================================================================
# REQUIRED: Stripe API keys from https://dashboard.stripe.com/apikeys
# Use sk_test_... keys for development/staging, sk_live_... for production
STRIPE_SECRET_KEY=
# REQUIRED: Stripe publishable key for client-side Stripe.js integration (safe to expose)
# Use pk_test_... keys for development/staging, pk_live_... for production
STRIPE_PUBLISHABLE_KEY=
# REQUIRED: Webhook signing secret from https://dashboard.stripe.com/webhooks
# Each environment should have its own webhook endpoint and signing secret
STRIPE_WEBHOOK_SECRET=

# =============================================================================
# Resend Email Service
# =============================================================================
# REQUIRED: API key from https://resend.com/api-keys
RESEND_API_KEY=
# Webhook signing secret (optional, for verifying webhook payloads)
RESEND_WEBHOOK_SECRET=
# Default "from" email address for transactional emails
RESEND_FROM_EMAIL=noreply@staticshop.io

# =============================================================================
# Port Configuration
# =============================================================================
FRONTEND_PORT=3000
SPRING_API_PORT=8080

# =============================================================================
# Worker Configuration
# =============================================================================
WORKER_CONCURRENCY=4

# =============================================================================
# JVM Configuration - Spring API
# Uses ZGC (low-latency garbage collector) optimized for virtual threads
# =============================================================================
# Override to customize JVM settings (default: ZGC with 1.5GB heap)
# IMPORTANT: JVM heap (-Xmx) should be ~75% of container memory limit to leave
# room for non-heap memory (metaspace, thread stacks, direct buffers, etc.)
# For SPRING_API_MEMORY_LIMIT=2G, use -Xmx1536m (1.5GB)
# JAVA_TOOL_OPTIONS=-XX:+UseZGC -XX:+ZGenerational -Xmx1536m -Xms512m -XX:+ExitOnOutOfMemoryError -Djava.security.egd=file:/dev/./urandom

# =============================================================================
# Resource Limits - Spring API
# =============================================================================
SPRING_API_CPU_LIMIT=2.0
SPRING_API_MEMORY_LIMIT=2G
SPRING_API_CPU_RESERVATION=0.5
SPRING_API_MEMORY_RESERVATION=512M

# =============================================================================
# JVM Configuration - Spring Workers
# =============================================================================
# Override to customize JVM settings for workers (default: same as API)
# IMPORTANT: JVM heap (-Xmx) should be ~75% of container memory limit
# For SPRING_WORKERS_MEMORY_LIMIT=2G, use -Xmx1536m (1.5GB)
# JAVA_TOOL_OPTIONS_WORKERS=-XX:+UseZGC -XX:+ZGenerational -Xmx1536m -Xms512m -XX:+ExitOnOutOfMemoryError -Djava.security.egd=file:/dev/./urandom

# =============================================================================
# Resource Limits - Spring Workers
# =============================================================================
SPRING_WORKERS_CPU_LIMIT=2.0
SPRING_WORKERS_MEMORY_LIMIT=2G
SPRING_WORKERS_CPU_RESERVATION=0.5
SPRING_WORKERS_MEMORY_RESERVATION=512M

# =============================================================================
# Resource Limits - Frontend
# =============================================================================
FRONTEND_CPU_LIMIT=0.5
FRONTEND_MEMORY_LIMIT=256M
FRONTEND_CPU_RESERVATION=0.1
FRONTEND_MEMORY_RESERVATION=64M

# =============================================================================
# Resource Limits - RabbitMQ
# =============================================================================
RABBITMQ_CPU_LIMIT=1.0
RABBITMQ_MEMORY_LIMIT=512M
RABBITMQ_CPU_RESERVATION=0.25
RABBITMQ_MEMORY_RESERVATION=256M

# =============================================================================
# Observability: Grafana Cloud OpenTelemetry
# =============================================================================
# OTLP endpoint for metrics and traces export
# Format: https://otlp-gateway-{region}.grafana.net/otlp
# Leave empty to disable metrics/traces export
GRAFANA_CLOUD_OTLP_ENDPOINT=

# OTLP headers for authentication
# Format: Authorization=Basic <base64(instance_id:api_token)>
# Generate with: echo -n "<instance_id>:<api_token>" | base64
# Leave empty if GRAFANA_CLOUD_OTLP_ENDPOINT is not set
OTEL_EXPORTER_OTLP_HEADERS=

# Service name for traces and metrics (identifies this service in dashboards)
OTEL_SERVICE_NAME=shopbuilder-api
OTEL_SERVICE_NAME_WORKERS=shopbuilder-workers

# Resource attributes (comma-separated key=value pairs)
# deployment.environment is used for filtering in Grafana dashboards
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=production

# Exporter configuration (otlp, console, or none)
OTEL_METRICS_EXPORTER=otlp
OTEL_TRACES_EXPORTER=otlp
OTEL_LOGS_EXPORTER=none

# =============================================================================
# Observability: Sentry Error Tracking
# =============================================================================
# DSN (Data Source Name) from Sentry project settings
# Format: https://<key>@<org>.ingest.sentry.io/<project_id>
# Leave empty to disable error reporting
SENTRY_DSN=

# Environment name for filtering in Sentry (e.g., production, staging, development)
SENTRY_ENVIRONMENT=production

# Traces sample rate for performance monitoring (0.0 to 1.0)
# 0.1 = 10% of transactions sampled for performance data
# Increase for more visibility, decrease to reduce costs
SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# Frontend Build Arguments (used when building the frontend Docker image)
# =============================================================================
# These are passed as --build-arg when building the frontend image:
#   docker build --build-arg VITE_API_URL=$VITE_API_URL ...
# VITE_API_URL=https://api.example.com
# VITE_SUPABASE_URL=https://xxx.supabase.co
# VITE_SUPABASE_ANON_KEY=
